from functools import lru_cache
'\nTest Neo-Clone brain with current and alternative models\n'
from brain_opencode import OpencodeBrain
from config_opencode import load_config
from skills import SkillRegistry
import logging

@lru_cache(maxsize=128)
def test_neo_clone_brain_models():
    logging.basicConfig(level=logging.INFO)
    print('Neo-Clone Brain Model Usage Test')
    print('=' * 50)
    print('\n1. Initializing Neo-Clone Brain:')
    print('-' * 40)
    config = load_config()
    skills = SkillRegistry()
    brain = OpencodeBrain(config, skills)
    current_model = brain.get_current_model()
    print(f'Current brain model: {current_model}')
    print('\n2. Testing Current Model:')
    print('-' * 40)
    test_query = 'What is Python programming in one sentence?'
    try:
        response = brain.send_message(test_query)
        print(f'[OK] Response: {response[:100]}...')
        print(f'[OK] Current model working!')
    except Exception as e:
        print(f'[ERROR] Current model failed: {e}')
    print('\n3. Testing Model Switching:')
    print('-' * 40)
    available_models = brain.llm.get_available_models()
    print(f'Brain has access to {len(available_models)} models')
    if 'opencode/grok-code' in available_models:
        print('Testing switch to opencode/grok-code...')
        try:
            switch_result = brain.switch_model('opencode/grok-code')
            print(f'[OK] Switch result: {switch_result}')
            response = brain.send_message('What is 5+5?')
            print(f'[OK] Response with grok-code: {response}')
        except Exception as e:
            print(f'[ERROR] Switch to grok-code failed: {e}')
    else:
        print('[INFO] grok-code not in available models')
    try:
        brain.switch_model(current_model)
        print(f'[OK] Switched back to: {brain.get_current_model()}')
    except Exception as e:
        print(f'[ERROR] Switch back failed: {e}')
    print('\n4. Testing Skill Usage:')
    print('-' * 40)
    try:
        code_response = brain.send_message('Generate a simple Python function that adds two numbers')
        print(f'[OK] Code generation: {code_response[:100]}...')
        analysis_response = brain.send_message('Analyze the benefits of using AI in software development')
        print(f'[OK] Analysis: {analysis_response[:100]}...')
    except Exception as e:
        print(f'[ERROR] Skill usage failed: {e}')
    print('\n5. Model Capabilities Summary:')
    print('-' * 40)
    print(f'[OK] Neo-Clone brain is ACTIVE and using: {brain.get_current_model()}')
    print(f'[OK] Can switch between {len(available_models)} models')
    print(f'[OK] Skills loaded: {len(skills.skills)}')
    print(f'[OK] All systems operational')
    print('\n6. Available Models for Switching:')
    print('-' * 40)
    working_models = [m for m in available_models[:10] if any((provider in m for provider in ['opencode', 'gemini', 'ollama', 'huggingface']))]
    for (i, model) in enumerate(working_models, 1):
        status = '[CURRENT]' if model == brain.get_current_model() else '         '
        print(f'{status} {i:2d}. {model}')
    print(f'\n[OK] Neo-Clone brain can use any of these models when needed!')
if __name__ == '__main__':
    test_neo_clone_brain_models()