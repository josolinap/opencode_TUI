from functools import lru_cache
'\nTest Neo-Clone brain with intelligent delegation\n'
from brain_opencode import OpencodeBrain
from config_opencode import load_config
from skills import SkillRegistry
import logging

@lru_cache(maxsize=128)
def test_brain_intelligent_delegation():
    logging.basicConfig(level=logging.INFO)
    print('Testing Neo-Clone Brain with Intelligent Delegation')
    print('=' * 60)
    config = load_config()
    skills = SkillRegistry()
    brain = OpencodeBrain(config, skills)
    print('\n1. Brain Status:')
    print('-' * 40)
    status = brain.get_status()
    print(f"Current model: {status.get('current_model', 'unknown')}")
    print(f"Intelligent delegation: {status.get('intelligent_delegation', 'disabled')}")
    print(f"Validated models: {status.get('validated_models', 0)}")
    print(f"Available task types: {status.get('available_task_types', [])}")
    print('\n2. Regular Message Processing:')
    print('-' * 40)
    regular_response = brain.send_message('What is the capital of France?')
    print(f'Response: {regular_response[:100]}...')
    if hasattr(brain, 'intelligent_delegate') and brain.model_manager:
        print('\n3. Intelligent Delegation Test:')
        print('-' * 40)
        test_tasks = [('What is 7 * 8?', 'Math task'), ('Write a Python function to calculate factorial', 'Code generation'), ('Debug this error: TypeError in Python', 'Code debugging'), ('Analyze the benefits of AI', 'Text analysis')]
        for (task, description) in test_tasks:
            print(f'\nTesting {description}:')
            print(f'Task: {task}')
            try:
                response = brain.intelligent_delegate(task)
                print(f'Success: {response[:200]}...')
            except Exception as e:
                print(f'Error: {e}')
        print('\n4. Model Recommendations Test:')
        print('-' * 40)
        recommendation_tasks = ['Create a web scraping script', 'Fix this memory leak in my code', 'Write a poem about technology']
        for task in recommendation_tasks:
            print(f'\nGetting recommendations for: {task}')
            try:
                recommendations = brain.get_model_recommendations(task)
                print(f'Recommendations: {recommendations}')
            except Exception as e:
                print(f'Error: {e}')
    else:
        print('\n3. Intelligent Delegation:')
        print('-' * 40)
        print('[INFO] Intelligent delegation not available in this brain instance')
    print('\n5. Model Switching Test:')
    print('-' * 40)
    try:
        switch_result = brain.switch_model('opencode/grok-code')
        print(f'Switch result: {switch_result}')
        switched_response = brain.send_message('What is 15 + 20?')
        print(f'Response with grok-code: {switched_response}')
        brain.switch_model('opencode/big-pickle')
        print('Switched back to big-pickle')
    except Exception as e:
        print(f'Model switching error: {e}')
    print('\n6. Final Status:')
    print('-' * 40)
    final_status = brain.get_status()
    print(f"Model switches: {final_status.get('model_switches', 0)}")
    print(f"Conversation stats: {final_status.get('conversation_stats', {})}")
    print(f"Available skills: {len(final_status.get('available_skills', []))}")
    print('\n[SUCCESS] Neo-Clone brain with intelligent delegation is working!')
    print('[OK] Can automatically select best models for tasks')
    print('[OK] Can provide model recommendations')
    print('[OK] Can switch between models dynamically')
    print('[OK] Has full awareness of available models')
if __name__ == '__main__':
    test_brain_intelligent_delegation()