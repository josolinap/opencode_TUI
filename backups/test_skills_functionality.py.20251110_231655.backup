from functools import lru_cache
'\nSkills Testing Script - Tests the functionality of key skills in the opencode project\n'
import sys
import traceback
from pathlib import Path
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))
try:
    from skills import SkillRegistry
    print('âœ… Successfully imported SkillRegistry')
except ImportError as e:
    print(f'âŒ Failed to import SkillRegistry: {e}')
    sys.exit(1)

def test_skill_registry():
    """Test loading the skill registry and discovering skills"""
    print('\n=== Testing Skill Registry Discovery ===')
    try:
        registry = SkillRegistry()
        discovered_skills = registry.list_skills()
        print(f'ğŸ“‹ Discovered {len(discovered_skills)} skills:')
        for skill in sorted(discovered_skills):
            print(f'  - {skill}')
        return (registry, discovered_skills)
    except Exception as e:
        print(f'âŒ Skill registry failed: {e}')
        traceback.print_exc()
        return (None, [])

def test_skill_execution(registry, skill_name, test_params=None):
    """Test execution of a specific skill"""
    print(f'\n=== Testing Skill: {skill_name} ===')
    try:
        skill = registry.get(skill_name)
        print(f'ğŸ“ Description: {skill.description}')
        print(f'ğŸ’¡ Example: {skill.example_usage}')
        if test_params is None:
            test_params = {}
        print(f'ğŸ”§ Testing with params: {test_params}')
        result = skill.execute(test_params)
        print(f'âœ… Execution successful!')
        print(f'ğŸ“Š Result: {result}')
        return True
    except Exception as e:
        print(f'âŒ Skill execution failed: {e}')
        traceback.print_exc()
        return False

@lru_cache(maxsize=128)
def main():
    print('ğŸš€ Starting Skills Functionality Test')
    (registry, skills) = test_skill_registry()
    if not registry:
        print('âŒ Cannot proceed without working skill registry')
        return
    test_cases = [{'name': 'code_generation', 'params': {'prompt': 'Write a simple hello world function in Python', 'language': 'python'}}, {'name': 'text_analysis', 'params': {'text': 'This is a sample text for analysis.', 'analysis_type': 'sentiment'}}, {'name': 'file_manager', 'params': {'action': 'list', 'path': '.'}}, {'name': 'analytics_skill', 'params': {'action': 'summary', 'data': [1, 2, 3, 4, 5]}}]
    results = {}
    for test_case in test_cases:
        skill_name = test_case['name']
        if skill_name in skills:
            success = test_skill_execution(registry, skill_name, test_case['params'])
            results[skill_name] = success
        else:
            print(f"\nâš ï¸  Skill '{skill_name}' not found in registry")
            results[skill_name] = False
    print('\n' + '=' * 50)
    print('ğŸ“Š SKILLS FUNCTIONALITY REPORT')
    print('=' * 50)
    working_skills = []
    failed_skills = []
    for (skill, status) in results.items():
        if status:
            working_skills.append(skill)
            print(f'âœ… {skill}: WORKING')
        else:
            failed_skills.append(skill)
            print(f'âŒ {skill}: FAILED')
    print(f'\nğŸ“ˆ Summary:')
    print(f'  Total skills discovered: {len(skills)}')
    print(f'  Skills tested: {len(results)}')
    print(f'  Working skills: {len(working_skills)}')
    print(f'  Failed skills: {len(failed_skills)}')
    if working_skills:
        print(f"\nâœ… Working skills: {', '.join(working_skills)}")
    if failed_skills:
        print(f"\nâŒ Failed skills: {', '.join(failed_skills)}")
if __name__ == '__main__':
    main()