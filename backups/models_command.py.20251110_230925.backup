from functools import lru_cache
'\nClean /models command showing only usable free models\n'
from llm_client_opencode import OpencodeLLMClient
from config_opencode import load_config

@lru_cache(maxsize=128)
def show_usable_models():
    config = load_config()
    client = OpencodeLLMClient(config)
    models = client.get_available_models()
    print('Neo-Clone USABLE Free Models')
    print('=' * 50)
    print(f'Total: {len(models)} verified free models')
    print()
    working_opencode = [m for m in models if m.startswith('opencode/')]
    gemini_models = [m for m in models if m.startswith('gemini/')]
    ollama_models = [m for m in models if m.startswith('ollama/')]
    huggingface_models = [m for m in models if m.startswith('huggingface/')]
    print('VERIFIED WORKING:')
    print('-' * 30)
    for model in working_opencode:
        if model == 'opencode/big-pickle':
            print(f'+ {model} (TESTED - Cost: 0)')
        else:
            print(f'? {model} (Available)')
    print('\nGEMINI CLI (Free):')
    print('-' * 30)
    for model in gemini_models:
        print(f'- {model}')
    print('\nOLLAMA (Local - Free):')
    print('-' * 30)
    for model in ollama_models:
        print(f'- {model}')
    print(f'\nHUGGINGFACE (Free):')
    print('-' * 30)
    for model in huggingface_models[:5]:
        print(f'- {model}')
    if len(huggingface_models) > 5:
        print(f'  ... and {len(huggingface_models) - 5} more')
    print('\nSUMMARY:')
    print('-' * 30)
    print(f'• Working Models: {len(working_opencode)}')
    print(f'• Gemini CLI: {len(gemini_models)}')
    print(f'• Ollama Local: {len(ollama_models)}')
    print(f'• HuggingFace: {len(huggingface_models)}')
    print(f'• Total Free Models: {len(models)}')
    print('\nRECOMMENDED USAGE:')
    print('-' * 30)
    print("client.set_model('opencode/big-pickle')  # Best working model")
    print("client.set_model('gemini/gemini-2.5-flash')  # Fast alternative")
    print('\nNOTE: All paid/API-key models have been filtered out!')
    print('Only verified free models are shown.')
if __name__ == '__main__':
    show_usable_models()