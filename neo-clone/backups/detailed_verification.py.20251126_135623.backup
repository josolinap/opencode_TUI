from functools import lru_cache
'\nDetailed Verification Analysis Script\nAuthor: MiniMax Agent\n\nThis script provides detailed analysis of plan compliance with specific recommendations.\n'
import json
from pathlib import Path

@lru_cache(maxsize=128)
def detailed_verification_analysis():
    """Perform detailed analysis of plan compliance"""
    print('ðŸ” Detailed Verification Analysis')
    print('=' * 60)
    plan_path = '/workspace/data/plans/demo_auth_system_plan.json'
    verifier = PlanVerificationSystem()
    report = verifier.verify_plan_compliance(plan_path)
    print(f'Plan: {report.plan_name}')
    print(f'Overall Score: {report.overall_score:.1f}%')
    print(f'Total Checks: {report.total_checks}')
    print(f'Passed: {report.passed_checks} | Failed: {report.failed_checks} | Warnings: {report.warning_checks}')
    print('\n' + '=' * 60)
    check_types = {}
    for result in report.results:
        check_type = result.check_name
        if check_type not in check_types:
            check_types[check_type] = []
        check_types[check_type].append(result)
    for (check_type, results) in check_types.items():
        print(f'\nðŸ“‹ {check_type.upper()}')
        print('-' * 40)
        passed = len([r for r in results if r.status == 'PASS'])
        failed = len([r for r in results if r.status == 'FAIL'])
        warnings = len([r for r in results if r.status == 'WARNING'])
        print(f'Status: {passed} passed, {failed} failed, {warnings} warnings')
        for result in results:
            status_emoji = {'PASS': 'âœ…', 'FAIL': 'âŒ', 'WARNING': 'âš ï¸', 'INFO': 'â„¹ï¸'}.get(result.status, 'â“')
            print(f"\n  {status_emoji} {result.file_path or 'General'}")
            print(f'     Message: {result.message}')
            print(f'     Expected: {result.expected}')
            print(f'     Actual: {result.actual}')
            if result.severity != 'medium':
                print(f'     Severity: {result.severity}')
    print('\n' + '=' * 60)
    print('ðŸ’¡ RECOMMENDATIONS')
    print('=' * 60)
    failed_results = [r for r in report.results if r.status == 'FAIL']
    warning_results = [r for r in report.results if r.status == 'WARNING']
    if failed_results:
        print('\nðŸš¨ CRITICAL ISSUES TO FIX:')
        for result in failed_results:
            print(f'  â€¢ {result.message}')
            if result.file_path:
                print(f'    File: {result.file_path}')
    if warning_results:
        print('\nâš ï¸  OPTIMIZATION OPPORTUNITIES:')
        for result in warning_results:
            print(f'  â€¢ {result.message}')
            if result.file_path:
                print(f'    File: {result.file_path}')
    output_file = '/workspace/data/verification_reports/detailed_analysis.json'
    Path(output_file).parent.mkdir(parents=True, exist_ok=True)
    with open(output_file, 'w') as f:
        json.dump({'report_summary': {'plan_name': report.plan_name, 'overall_score': report.overall_score, 'timestamp': report.verification_time, 'summary': report.summary}, 'detailed_results': [{'check_name': r.check_name, 'status': r.status, 'message': r.message, 'expected': r.expected, 'actual': r.actual, 'file_path': r.file_path, 'severity': r.severity} for r in report.results]}, f, indent=2)
    print(f'\nðŸ“„ Detailed report saved to: {output_file}')
    print('\n' + '=' * 60)
    print('ðŸ“Š VERIFICATION DASHBOARD')
    print('=' * 60)
    dashboard = verifier.get_verification_dashboard([report])
    print(f"Average Score: {dashboard['dashboard_summary']['average_score']:.1f}%")
    print(f'Status Distribution:')
    for (status, count) in dashboard['dashboard_summary']['status_distribution'].items():
        if count > 0:
            print(f"  â€¢ {status.replace('_', ' ').title()}: {count}")
if __name__ == '__main__':
    detailed_verification_analysis()